---
trigger: always_on
---

# communication
* すべての説明・コメント・コミットメッセージは基本的に日本語で書くこと。
* コード内の識別子（変数名・関数名）は英語を使うこと。
* 質問やタスクに必要な情報が不足している場合は、その旨を指摘し、次に必要な情報を具体的に要求すること。
* 推測する場合は根拠を明記し、事実と推測を混同しないこと。
* より良い代替案や改善策がある場合、求められていなくても積極的に提案すること。その際は、提案理由と現状案との比較を明示すること。

# coding rules
* 主要エントリー関数は、全体の処理の流れをつかみやすいように、主要な処理ステップを順序立てて呼び出す直列構造を基本とすること。また、複雑な関数は補助関数に分割する、各関数には処理の流れと役割が明確に分かるコメントをつける、など簡潔で読みやすい構造を保つこと。
* 設定値は`config.json`等の専用ファイル、またはコード冒頭部などの特定個所にまとめて記述するなどし、重複や分散を避けること。また、magic number/magic stringは極力避けること。
* テスト容易性を常に意識し、モジュール間の依存関係を最小限に抑えた設計をすること。
* 例外処理の方針として、以下を基本とすること。
  * 補助関数では例外を捕捉しせずに、呼び出し元に伝搬させること。
  * 主要エントリー関数で例外をまとめて捕捉し、ログ関数で集約すること。
  * エラーメッセージは原因特定や対処方法がわかりやすい内容にすること。
  * 原則として例外を無視したり、ログを残さずに握りつぶすことは禁止する。ただし、UI層でのユーザーフレンドリーな通知のために例外内容を一部隠す場合は例外とする。
  
# Documentation rules
* 作成するドキュメントは、すべて`/documents/`下に配置すること。`/documents/`が存在しない場合は、フォルダを作成すること。
* ドキュメントは、`/documents/`下に存在しない場合は新たに作成すること。
* ドキュメントはコードの変更に伴い適宜変更し、最新の状態に保つこと。

## `README.md` rules
* `/documents/README.md`には、そのディレクトリの目的、使用方法、依存関係、実行手順、トラブルシューティング等の情報を明記すること。

## `IntentLog.md` rules
* `/documents/IntentLog.md`の記録、整備は、実装と同じくらい重要なものと認識すること。
* `IntentLog.md`の目的は、設計思想を簡潔な逐次メモとして記載することで、設計書などの公式文書は後に`IntentLog.md`の内容を整理しなおして作成する。
* `IntentLog.md`は以下のセクションを基本とすること。
  * `全体設計方針`：現在のプロジェクト全体の設計方針等を記載する。既存の設計意図の変更、新しい全体設計方針を追加する場合は、必ずユーザーに了承を得てから行うこと。
  * `設計意図と実装ログ`：関数・モジュール単位の変更点やその意図を、作業ごとに2～5行を目安に簡潔に追記すること。形式は **[YYYY-MM-DD HH:mm] 対象: 内容（意図）** とする。
  * `アーカイブ`：解決済みのものや、後に公式ドキュメントにする際に役立ちそうな重要メモを記載する。
* `IntentLog.md` のエントリは「何をしたか」ではなく「なぜそうしたか」を中心に書くこと。
* 不要になったメモは削除せず、`アーカイブ`セクションに移動すること。
* 仕様変更を伴う変更は必ず`IntentLog.md`に記録する。

## Task management rules
* タスクや開発計画の正本は、リポジトリ内の`/documents/TODO.md`とし、その内容に従うこと。
* IDE上のタスク管理機能は、あくまで補助的なUIとして利用してよい。
* IDE 固有のタスク機能だけにタスクを保存し、`TODO.md`に反映しない運用は避けること。
* 新規タスクが発生した場合、`TODO.md`に追記してから実行すること。
* タスクを完了した場合、該当項目に完了マーク`[x]`を付与する差分案を提示すること。
* `TODO.md`の内容と実装内容に不整合がある場合、ユーザーに確認と同期を提案すること。
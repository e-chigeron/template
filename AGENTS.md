---
trigger: always_on
---

# 1. communication
- 説明・コメント・コミットメッセージは日本語で記載する。
- コード内の識別子（変数名・関数名）は英語を用いる。
- 必要情報が不足している場合は不足点を指摘し、具体的に追加情報を求める。
- 推測をする場合は根拠を明示し、事実と推測を混同しない。
- より良い代替案や改善案があれば、理由と現状案との比較を示し積極的に提案する。
- 大きな失敗や行き詰まりがあれば内容と原因を詳述し、必要な対応策を提示したうえで遠慮なく相談する。

# 2. coding rules
- 主要エントリー関数は処理ステップを順に呼び出す直列構造を基本とし、複雑な処理は補助関数に分割する。各関数には流れと役割が分かる簡潔なコメントを付ける。
- 設定値は `config.json` 等の専用ファイル、またはコード冒頭など特定箇所に集約し、重複や分散を避ける。magic number/magic string は極力避ける。
- テスト容易性を意識し、モジュール間の依存を最小限に抑える。
- 例外処理方針:
  - 補助関数では例外を捕捉せず呼び出し元へ伝搬させる。
  - 主要エントリー関数で例外をまとめて捕捉し、ログ関数で集約する。
  - エラーメッセージは原因特定と対処が分かる内容にする。
  - 原則として例外を無視・握り潰さない（UI層でユーザーフレンドリーにするため内容を一部隠す場合のみ例外）。

# 3. `README.md` rules
- `README.md` は作業フォルダのルートに配置する。
- `README.md` にはディレクトリの目的、使用方法、依存関係、実行手順、トラブルシューティング等を明記する。

# 4. IntentLog（設計意図ログ）
IntentLog は実装の「理由」を逐次記録するためのドキュメント。保守やリファクタリングの指針となるため、十分な粒度で一貫して記録する。

## 4.1 配置と形式
- `/documents/` 配下に Markdown で設置（例: `documents/IntentLog_プロジェクト名.md`）。
- 基本は日本語で記録する。

## 4.2 更新の原則
- 非トリビアルな実装・修正を行ったやり取りでは、必ず IntentLog を更新する。
  - 新規関数追加、仕様変更、I/O・例外処理追加などは記録必須。
  - コメント修正やタイポ訂正など軽微な変更は記録不要。
- 一度のやり取りで複数関数を実装・修正した場合は関数単位で複数エントリを追加する。

## 4.3 セクション構造
1. **全体設計方針**: プロジェクトの基本思想・アーキテクチャ背景を記述。根幹方針を変える場合はユーザーの明確な了承を得る。
2. **設計意図と実装ログ**: 各関数・モジュールごとに 1〜3 行で理由を記録。複数関数をまとめて修正した場合も個別に箇条書き。仕様変更時は既存記述を残したまま追記する。例:
   ```
   - parseConfig
     [2025-12-04 22:15]: 列変更への追従性を高めるためマッピングテーブル方式へ変更。
     [2025-12-04 23:00]: コンストラクタを追加し、コンフィグ変更に対応。
   - buildPayload
     [2025-12-04 22:15]: API仕様変更に伴い requestId を追加し、追跡性を向上。
   ```
3. **アーカイブ**: 完了した重要メモや方針転換の履歴を移動し、削除せず保持する。

## 4.4 実装計画書との連携
- `implementation_plan.md` などツール自動生成の実装計画書がある場合、重要部分を日本語で要約し「設計意図と実装ログ」に追記する。

## 4.5 運用上の補足
- IntentLog は後で整理するための逐次メモとして扱う。
